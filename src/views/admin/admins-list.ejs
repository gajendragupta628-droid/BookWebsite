<% layout('../layouts/admin') %>

<div class="admin-card-header" style="margin-top: 0;">
  <h1 class="admin-card-title" style="font-size: 1.75rem; margin: 0;">Admin Users</h1>
  <div class="admin-card-actions">
    <a href="/admin/settings" class="admin-btn admin-btn-sm admin-btn-secondary">Back to Settings</a>
  </div>
</div>

<% if (typeof flash !== 'undefined' && flash.success && flash.success.length > 0) { %>
  <div class="admin-alert admin-alert-success" style="margin-bottom: 1.5rem;">
    <%= flash.success[0] %>
  </div>
<% } %>

<% if (typeof flash !== 'undefined' && flash.error && flash.error.length > 0) { %>
  <div class="admin-alert admin-alert-danger" style="margin-bottom: 1.5rem;">
    <%= flash.error[0] %>
  </div>
<% } %>

<!-- Create New Admin -->
<div class="admin-card" style="margin-bottom: 1.5rem;">
  <div class="admin-card-header">
    <h2 class="admin-card-title">Create New Admin User</h2>
  </div>
  <div class="admin-card-body">
    <form action="/admin/admins" method="POST" class="admin-form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      
      <div class="admin-form-group">
        <label class="admin-form-label">Email Address</label>
        <input type="email" name="email" class="admin-form-input" required>
      </div>
      
      <div class="admin-form-group">
        <label class="admin-form-label">Password</label>
        <input type="password" name="password" class="admin-form-input" required minlength="8">
        <div class="admin-form-help">Must be at least 8 characters long</div>
      </div>
      
      <div class="admin-form-group">
        <label class="admin-form-label">Confirm Password</label>
        <input type="password" name="confirmPassword" class="admin-form-input" required minlength="8">
      </div>
      
      <div class="admin-form-actions">
        <button type="submit" class="admin-btn admin-btn-primary">Create Admin</button>
      </div>
    </form>
  </div>
</div>

<!-- Admin Users List -->
<div class="admin-card">
  <div class="admin-card-header">
    <h2 class="admin-card-title">All Admin Users</h2>
  </div>
  <div class="admin-card-body">
    <% if (admins && admins.length > 0) { %>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Email</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% admins.forEach(admin => { %>
              <tr>
                <td><%= admin.email %></td>
                <td><%= new Date(admin.createdAt).toLocaleDateString() %></td>
                <td>
                  <% if (admin._id.toString() !== session.adminUserId) { %>
                    <form action="/admin/admins/<%= admin._id %>/delete" method="POST" style="display: inline;">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit" class="admin-btn admin-btn-sm admin-btn-danger" onclick="return confirm('Are you sure you want to delete this admin user?')">Delete</button>
                    </form>
                  <% } else { %>
                    <span class="admin-badge admin-badge-info">Current User</span>
                  <% } %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p style="color: var(--admin-text-muted);">No admin users found.</p>
    <% } %>
  </div>
</div>

<style>
.admin-form {
  max-width: 500px;
}

.admin-form-group {
  margin-bottom: 1.5rem;
}

.admin-form-label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--admin-text);
  font-size: 0.875rem;
}

.admin-form-input {
  width: 100%;
  padding: 0.75rem;
  background: var(--admin-bg-secondary);
  border: 1px solid var(--admin-border);
  border-radius: 6px;
  color: var(--admin-text);
  font-size: 0.875rem;
}

.admin-form-input:focus {
  outline: none;
  border-color: var(--admin-primary);
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
}

.admin-form-help {
  margin-top: 0.25rem;
  font-size: 0.75rem;
  color: var(--admin-text-muted);
}

.admin-form-actions {
  margin-top: 1.5rem;
}
</style>

